<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Production Capacity Planner (v4.6.1)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 1. Force ARIAL Font */
        body, input, button, select, textarea {
            font-family: 'Arial', sans-serif !important;
            background-color: #F5F5F7;
            color: #1D1D1F;
            -webkit-font-smoothing: antialiased;
        }

        /* Glassmorphism Header */
        .glass-header {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: saturate(180%) blur(20px);
            -webkit-backdrop-filter: saturate(180%) blur(20px);
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        /* Mac Style Card */
        .mac-card {
            background: #FFFFFF;
            border-radius: 18px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border: 1px solid rgba(0,0,0,0.02);
            padding: 24px;
        }

        /* Inputs & Select */
        .mac-input, .mac-select {
            background: #F5F5F7;
            border: 1px solid #E5E5E5;
            border-radius: 8px;
            padding: 6px 12px;
            font-size: 14px;
            transition: all 0.2s;
            width: 100%;
            text-align: right;
            font-weight: bold;
            color: #333;
            /* Reset appearance for select */
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        .mac-input:focus, .mac-select:focus {
            background: #FFFFFF;
            border-color: #007AFF;
            box-shadow: 0 0 0 3px rgba(0,122,255,0.2);
            outline: none;
        }

        /* Labels */
        .label-text {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #86868B;
            font-weight: 600;
            margin-bottom: 4px;
            display: block;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: bold;
            color: #1D1D1F;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
        }

        .result-box {
            background-color: #FBFBFD;
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            border: 1px solid #E5E5E5;
        }
        .result-label { font-size: 10px; color: #86868B; text-transform: uppercase; margin-bottom: 4px; }
        .result-value { font-size: 18px; font-weight: bold; color: #1D1D1F; }

        /* Sub-section divider */
        .subsection-divider {
            border-top: 1px dashed #E5E5E5;
            margin: 40px 0 20px 0;
            position: relative;
        }
        .subsection-label {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: #F5F5F7;
            padding: 0 10px;
            color: #86868B;
            font-size: 12px;
            font-weight: bold;
        }
    </style>
</head>
<body class="pb-20">

    <header class="glass-header sticky top-0 z-50 py-4 px-6 mb-8">
        <div class="w-full flex flex-col md:grid md:grid-cols-[1fr_auto_1fr] items-center gap-4">
            
            <div class="hidden md:block"></div>

            <div class="flex items-center gap-3 md:justify-self-center">
                <div class="p-1.5 rounded-xl bg-white/50 backdrop-blur-md border border-white/40 shadow-sm">
                    <img src="img/logo_company.png" alt="Company Logo" class="w-8 h-8 rounded-lg object-cover" />
                </div>
                <div>
                    <h1 class="text-lg font-bold tracking-tight text-center md:text-left">Capacity Planner</h1>
                    <p class="text-[11px] text-gray-500 text-center md:text-left">Daily • Monthly • Yearly (KR Calendar)</p>
                </div>
            </div>
            
            <div class="flex gap-4 md:justify-self-end">
                <div class="flex items-center bg-white px-4 py-2 rounded-full shadow-sm border border-gray-200">
                    <span class="text-xs font-bold text-gray-500 mr-2">DAILY HRS</span>
                    <input type="number" id="globalWorkTime" value="6.0" step="0.1" class="mac-input w-16 text-center !bg-transparent !p-0 !border-none text-lg text-black focus:ring-0" onchange="calculateAll()">
                </div>
                
                <div class="flex items-center bg-white px-4 py-2 rounded-full shadow-sm border border-gray-200">
                    <span class="text-xs font-bold text-gray-500 mr-2">DAYS / YR</span>
                    <select id="yearSelector" class="mac-select w-20 text-center !bg-transparent !p-0 !border-none text-lg text-black focus:ring-0 mr-2" onchange="calculateAll()">
                        </select>
                    <div class="text-lg font-bold text-black" id="annualWorkingDaysDisplay">245</div>
                    <span class="text-[10px] text-gray-400 ml-2 border-l pl-2 leading-tight">Excl.<br>Holidays</span>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 max-w-5xl">
        
        <section class="mb-10">
            <div class="section-title">
                1. RF Generator (Combined Model)
                <span class="ml-3 text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded">2K & 1K Platforms</span>
            </div>

            <div class="mac-card">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    
                    <div class="bg-subtle">
                        <h4 class="text-sm font-bold text-gray-900 mb-4 border-b pb-2">A. Total Resources</h4>
                        <div class="space-y-4">
                            <div>
                                <label class="label-text">Total Assy Headcount</label>
                                <input type="number" id="rfg_total_assy_worker" value="6" class="mac-input" onchange="calculateAll()">
                            </div>
                            <div>
                                <label class="label-text">Total Test Headcount</label>
                                <input type="number" id="rfg_total_test_worker" value="3" class="mac-input" onchange="calculateAll()">
                            </div>
                            <div>
                                <label class="label-text">Total # of Lines</label>
                                <input type="number" id="rfg_total_lines" value="4" class="mac-input" onchange="calculateAll()">
                                <div class="text-[10px] mt-1 text-right flex justify-end gap-1 items-center">
                                    <span class="text-gray-400">Max Staffed:</span>
                                    <span id="rfg_max_usable_lines" class="font-bold">0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-subtle border border-blue-100 p-6">
                        <h4 class="text-sm font-bold text-blue-900 mb-4 border-b border-blue-100 pb-2">B. Strategy & Ratio</h4>
                        <div class="space-y-4">
                            <div>
                                <label class="label-text text-blue-600">1K Allocation (Volume %)</label>
                                <div class="flex items-center">
                                    <input type="number" id="rfg_1k_alloc_pct" value="40" class="mac-input !text-blue-600" onchange="calculateAll()">
                                    <span class="ml-2 text-sm font-bold text-gray-400">%</span>
                                </div>
                                <div class="text-[10px] text-gray-400 mt-1">2K Allocation: <span id="rfg_2k_alloc_disp">60</span>%</div>
                            </div>
                            <div class="pt-2 border-t border-dashed border-gray-300">
                                <label class="label-text">1K Assy TAT Ratio</label>
                                <div class="flex items-center">
                                    <span class="text-xs text-gray-400 mr-2">vs 2K</span>
                                    <input type="number" id="rfg_1k_assy_ratio" value="80" class="mac-input" onchange="calculateAll()">
                                    <span class="ml-2 text-sm font-bold text-gray-400">%</span>
                                </div>
                            </div>
                            <div>
                                <label class="label-text">1K Test TAT Ratio</label>
                                <div class="flex items-center">
                                    <span class="text-xs text-gray-400 mr-2">vs 2K</span>
                                    <input type="number" id="rfg_1k_test_ratio" value="100" class="mac-input" onchange="calculateAll()">
                                    <span class="ml-2 text-sm font-bold text-gray-400">%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex flex-col h-full">
                        <div class="bg-subtle mb-4">
                            <h4 class="text-sm font-bold text-gray-900 mb-4 border-b pb-2">C. Baseline (2K Data)</h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="label-text">2K Assy TAT <span class="text-[9px] text-gray-400 font-normal ml-1">(Hrs)</span></label>
                                    <input type="number" id="rfg_2k_base_assy_tat" value="5.00" step="0.01" class="mac-input" onchange="calculateAll()">
                                </div>
                                <div>
                                    <label class="label-text">2K Test TAT <span class="text-[9px] text-gray-400 font-normal ml-1">(Hrs)</span></label>
                                    <input type="number" id="rfg_2k_base_test_tat" value="4.00" step="0.01" class="mac-input" onchange="calculateAll()">
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-900 text-white rounded-xl p-4 shadow-lg flex-grow flex flex-col justify-center">
                            <div class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 text-center">Total RFG Capacity</div>
                            <div class="grid grid-cols-3 gap-2 text-center divide-x divide-gray-700">
                                <div>
                                    <div class="text-[10px] text-gray-400 mb-1">DAILY</div>
                                    <div class="text-xl font-bold" id="rfg_total_capa_d">0</div>
                                </div>
                                <div>
                                    <div class="text-[10px] text-gray-400 mb-1">MONTHLY</div>
                                    <div class="text-xl font-bold text-blue-300" id="rfg_total_capa_m">0</div>
                                </div>
                                <div>
                                    <div class="text-[10px] text-gray-400 mb-1">YEARLY</div>
                                    <div class="text-xl font-bold text-green-400" id="rfg_total_capa_y">0</div>
                                </div>
                            </div>
                            <div id="rfg_bottleneck" class="mt-3 text-[10px] font-bold text-red-400 text-center border-t border-gray-700 pt-2">
                                </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="mb-10">
            <div class="section-title">
                2. RF Matcher (Combined Model)
                <span class="ml-3 text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded">DRFM & SRFM Platforms</span>
            </div>

            <div class="mac-card">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    
                    <div class="bg-subtle">
                        <h4 class="text-sm font-bold text-gray-900 mb-4 border-b pb-2">A. Total Resources</h4>
                        <div class="space-y-4">
                            <div>
                                <label class="label-text">Total Assy Headcount</label>
                                <input type="number" id="rfm_total_assy_worker" value="4" class="mac-input" onchange="calculateAll()">
                            </div>
                            <div>
                                <label class="label-text">Total Test Headcount</label>
                                <input type="number" id="rfm_total_test_worker" value="2.5" step="0.1" class="mac-input" onchange="calculateAll()">
                            </div>
                            <div>
                                <label class="label-text">Total # of Lines</label>
                                <input type="number" id="rfm_total_lines" value="3" class="mac-input" onchange="calculateAll()">
                                <div class="text-[10px] mt-1 text-right flex justify-end gap-1 items-center">
                                    <span class="text-gray-400">Max Staffed:</span>
                                    <span id="rfm_max_usable_lines" class="font-bold">0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-subtle border border-blue-100 p-6">
                        <h4 class="text-sm font-bold text-blue-900 mb-4 border-b border-blue-100 pb-2">B. Strategy & Ratio</h4>
                        <div class="space-y-4">
                            <div>
                                <label class="label-text text-blue-600">SRFM Allocation (Volume %)</label>
                                <div class="flex items-center">
                                    <input type="number" id="rfm_srfm_alloc_pct" value="70" class="mac-input !text-blue-600" onchange="calculateAll()">
                                    <span class="ml-2 text-sm font-bold text-gray-400">%</span>
                                </div>
                                <div class="text-[10px] text-gray-400 mt-1">DRFM Allocation: <span id="rfm_drfm_alloc_disp">30</span>%</div>
                            </div>
                            <div class="pt-2 border-t border-dashed border-gray-300">
                                <label class="label-text">SRFM Assy TAT Ratio</label>
                                <div class="flex items-center">
                                    <span class="text-xs text-gray-400 mr-2">vs DRFM</span>
                                    <input type="number" id="rfm_srfm_assy_ratio" value="25" class="mac-input" onchange="calculateAll()">
                                    <span class="ml-2 text-sm font-bold text-gray-400">%</span>
                                </div>
                            </div>
                            <div>
                                <label class="label-text">SRFM Test TAT Ratio</label>
                                <div class="flex items-center">
                                    <span class="text-xs text-gray-400 mr-2">vs DRFM</span>
                                    <input type="number" id="rfm_srfm_test_ratio" value="66" class="mac-input" onchange="calculateAll()">
                                    <span class="ml-2 text-sm font-bold text-gray-400">%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex flex-col h-full">
                        <div class="bg-subtle mb-4">
                            <h4 class="text-sm font-bold text-gray-900 mb-4 border-b pb-2">C. Baseline (DRFM Data)</h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="label-text">DRFM Assy TAT <span class="text-[9px] text-gray-400 font-normal ml-1">(Hrs)</span></label>
                                    <input type="number" id="rfm_drfm_base_assy_tat" value="4.00" step="0.01" class="mac-input" onchange="calculateAll()">
                                </div>
                                <div>
                                    <label class="label-text">DRFM Test TAT <span class="text-[9px] text-gray-400 font-normal ml-1">(Hrs)</span></label>
                                    <input type="number" id="rfm_drfm_base_test_tat" value="3.00" step="0.01" class="mac-input" onchange="calculateAll()">
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-900 text-white rounded-xl p-4 shadow-lg flex-grow flex flex-col justify-center">
                            <div class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 text-center">Total RFM Capacity</div>
                            <div class="grid grid-cols-3 gap-2 text-center divide-x divide-gray-700">
                                <div>
                                    <div class="text-[10px] text-gray-400 mb-1">DAILY</div>
                                    <div class="text-xl font-bold" id="rfm_total_capa_d">0</div>
                                </div>
                                <div>
                                    <div class="text-[10px] text-gray-400 mb-1">MONTHLY</div>
                                    <div class="text-xl font-bold text-blue-300" id="rfm_total_capa_m">0</div>
                                </div>
                                <div>
                                    <div class="text-[10px] text-gray-400 mb-1">YEARLY</div>
                                    <div class="text-xl font-bold text-green-400" id="rfm_total_capa_y">0</div>
                                </div>
                            </div>
                            <div id="rfm_bottleneck" class="mt-3 text-[10px] font-bold text-red-400 text-center border-t border-gray-700 pt-2">
                                </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="mb-20">
            <div class="section-title">
                3. EVC (Combined Model)
                <span class="ml-3 text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded">Quantum & Tykon</span>
            </div>

            <div class="mac-card mb-8">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    
                    <div class="bg-subtle">
                        <h4 class="text-sm font-bold text-gray-900 mb-4 border-b pb-2">A. Total Resources</h4>
                        <div class="space-y-4">
                            <div>
                                <label class="label-text">Total Assy Headcount</label>
                                <input type="number" id="evc_com_total_assy_worker" value="5" class="mac-input" onchange="calculateAll()">
                            </div>
                            <div>
                                <label class="label-text">Total Test Headcount</label>
                                <input type="number" id="evc_com_total_test_worker" value="4" class="mac-input" onchange="calculateAll()">
                            </div>
                            <div>
                                <label class="label-text">Total # of Lines</label>
                                <input type="number" id="evc_com_total_lines" value="4" class="mac-input" onchange="calculateAll()">
                                <div class="text-[10px] mt-1 text-right flex justify-end gap-1 items-center">
                                    <span class="text-gray-400">Max Staffed:</span>
                                    <span id="evc_com_max_usable_lines" class="font-bold">0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-subtle border border-blue-100 p-6">
                        <h4 class="text-sm font-bold text-blue-900 mb-4 border-b border-blue-100 pb-2">B. Strategy & Ratio</h4>
                        <div class="space-y-4">
                            <div>
                                <label class="label-text text-blue-600">Tykon Allocation (Volume %)</label>
                                <div class="flex items-center">
                                    <input type="number" id="evc_tykon_alloc_pct" value="40" class="mac-input !text-blue-600" onchange="calculateAll()">
                                    <span class="ml-2 text-sm font-bold text-gray-400">%</span>
                                </div>
                                <div class="text-[10px] text-gray-400 mt-1">Quantum Allocation: <span id="evc_quantum_alloc_disp">60</span>%</div>
                            </div>
                            <div class="pt-2 border-t border-dashed border-gray-300">
                                <label class="label-text">Tykon Assy TAT Ratio</label>
                                <div class="flex items-center">
                                    <span class="text-xs text-gray-400 mr-2">vs Quantum</span>
                                    <input type="number" id="evc_tykon_assy_ratio" value="85" class="mac-input" onchange="calculateAll()">
                                    <span class="ml-2 text-sm font-bold text-gray-400">%</span>
                                </div>
                            </div>
                            <div>
                                <label class="label-text">Tykon Test TAT Ratio</label>
                                <div class="flex items-center">
                                    <span class="text-xs text-gray-400 mr-2">vs Quantum</span>
                                    <input type="number" id="evc_tykon_test_ratio" value="80" class="mac-input" onchange="calculateAll()">
                                    <span class="ml-2 text-sm font-bold text-gray-400">%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex flex-col h-full">
                        <div class="bg-subtle mb-4">
                            <h4 class="text-sm font-bold text-gray-900 mb-4 border-b pb-2">C. Baseline (Quantum)</h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="label-text">Quantum Assy TAT <span class="text-[9px] text-gray-400 font-normal ml-1">(Hrs)</span></label>
                                    <input type="number" id="evc_q_base_assy_tat" value="6.00" step="0.01" class="mac-input" onchange="calculateAll()">
                                </div>
                                <div>
                                    <label class="label-text">Quantum Test TAT <span class="text-[9px] text-gray-400 font-normal ml-1">(Hrs)</span></label>
                                    <input type="number" id="evc_q_base_test_tat" value="8.00" step="0.01" class="mac-input" onchange="calculateAll()">
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-900 text-white rounded-xl p-4 shadow-lg flex-grow flex flex-col justify-center">
                            <div class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 text-center">Total EVC Capacity</div>
                            <div class="grid grid-cols-3 gap-2 text-center divide-x divide-gray-700">
                                <div>
                                    <div class="text-[10px] text-gray-400 mb-1">DAILY</div>
                                    <div class="text-xl font-bold" id="evc_com_total_capa_d">0</div>
                                </div>
                                <div>
                                    <div class="text-[10px] text-gray-400 mb-1">MONTHLY</div>
                                    <div class="text-xl font-bold text-blue-300" id="evc_com_total_capa_m">0</div>
                                </div>
                                <div>
                                    <div class="text-[10px] text-gray-400 mb-1">YEARLY</div>
                                    <div class="text-xl font-bold text-green-400" id="evc_com_total_capa_y">0</div>
                                </div>
                            </div>
                            <div id="evc_com_bottleneck" class="mt-3 text-[10px] font-bold text-red-400 text-center border-t border-gray-700 pt-2">
                                </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="subsection-divider">
                <span class="subsection-label">Individual Mode Analysis</span>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="mac-card">
                    <h3 class="font-bold mb-4 border-b pb-2">Quantum (Individual)</h3>
                    <div class="grid grid-cols-2 gap-6 mb-4">
                        <div class="bg-blue-50/50 p-3 rounded-xl border border-blue-50">
                            <h5 class="text-[10px] font-bold text-blue-500 mb-3 uppercase">Assembly</h5>
                            <div class="space-y-3">
                                <div>
                                    <label class="label-text">Assy TAT (Hrs)</label>
                                    <input type="number" id="evc_q_assy_tat" value="6.00" step="0.01" class="mac-input" onchange="calculateAll()">
                                </div>
                                <div>
                                    <label class="label-text">Assy HC</label>
                                    <input type="number" id="evc_q_assy_worker" value="3" class="mac-input" onchange="calculateAll()">
                                </div>
                            </div>
                        </div>

                        <div class="bg-green-50/50 p-3 rounded-xl border border-green-50">
                            <h5 class="text-[10px] font-bold text-green-500 mb-3 uppercase">Test</h5>
                            <div class="space-y-3">
                                <div>
                                    <label class="label-text">Test TAT (Hrs)</label>
                                    <input type="number" id="evc_q_test_tat" value="8.00" step="0.01" class="mac-input" onchange="calculateAll()">
                                </div>
                                <div>
                                    <label class="label-text">Test HC</label>
                                    <input type="number" id="evc_q_test_worker" value="3" class="mac-input" onchange="calculateAll()">
                                </div>
                                <div>
                                    <label class="label-text">Test Lines</label>
                                    <input type="number" id="evc_q_line" value="3" class="mac-input" onchange="calculateAll()">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-2 mt-4 pt-4 border-t border-gray-100">
                        <div class="result-box">
                            <div class="result-label">Daily</div>
                            <div class="result-value" id="evc_q_capa_d">0</div>
                        </div>
                        <div class="result-box">
                            <div class="result-label">Monthly</div>
                            <div class="result-value text-blue-600" id="evc_q_capa_m">0</div>
                        </div>
                        <div class="result-box">
                            <div class="result-label">Yearly</div>
                            <div class="result-value text-green-600" id="evc_q_capa_y">0</div>
                        </div>
                    </div>
                    <div id="evc_q_bottleneck" class="text-[10px] text-center font-bold text-red-500 mt-2"></div>
                </div>

                <div class="mac-card">
                    <h3 class="font-bold mb-4 border-b pb-2">Tykon (Individual)</h3>
                    <div class="grid grid-cols-2 gap-6 mb-4">
                        <div class="bg-blue-50/50 p-3 rounded-xl border border-blue-50">
                            <h5 class="text-[10px] font-bold text-blue-500 mb-3 uppercase">Assembly</h5>
                            <div class="space-y-3">
                                <div>
                                    <label class="label-text">Assy TAT (Hrs)</label>
                                    <input type="number" id="evc_t_assy_tat" value="5.00" step="0.01" class="mac-input" onchange="calculateAll()">
                                </div>
                                <div>
                                    <label class="label-text">Assy HC</label>
                                    <input type="number" id="evc_t_assy_worker" value="2" class="mac-input" onchange="calculateAll()">
                                </div>
                            </div>
                        </div>

                        <div class="bg-green-50/50 p-3 rounded-xl border border-green-50">
                            <h5 class="text-[10px] font-bold text-green-500 mb-3 uppercase">Test</h5>
                            <div class="space-y-3">
                                <div>
                                    <label class="label-text">Test TAT (Hrs)</label>
                                    <input type="number" id="evc_t_test_tat" value="6.50" step="0.01" class="mac-input" onchange="calculateAll()">
                                </div>
                                <div>
                                    <label class="label-text">Test HC</label>
                                    <input type="number" id="evc_t_test_worker" value="2" class="mac-input" onchange="calculateAll()">
                                </div>
                                <div>
                                    <label class="label-text">Test Lines</label>
                                    <input type="number" id="evc_t_line" value="3" class="mac-input" onchange="calculateAll()">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-3 gap-2 mt-4 pt-4 border-t border-gray-100">
                        <div class="result-box">
                            <div class="result-label">Daily</div>
                            <div class="result-value" id="evc_t_capa_d">0</div>
                        </div>
                        <div class="result-box">
                            <div class="result-label">Monthly</div>
                            <div class="result-value text-blue-600" id="evc_t_capa_m">0</div>
                        </div>
                        <div class="result-box">
                            <div class="result-label">Yearly</div>
                            <div class="result-value text-green-600" id="evc_t_capa_y">0</div>
                        </div>
                    </div>
                    <div id="evc_t_bottleneck" class="text-[10px] text-center font-bold text-red-500 mt-2"></div>
                </div>
            </div>
        </section>

    </main>

    <script>
        // Only independent products remain here (EVC)
        const products = [
            { id: 'evc_q' }, { id: 'evc_t' }
        ];

        // 3. Dynamic KR Working Days Data
        const KR_WORKING_DAYS = {
            '2024': 247, 
            '2025': 246, 
            '2026': 247, 
            '2027': 247
        };

        function getVal(id) {
            return parseFloat(document.getElementById(id).value) || 0;
        }

        function setHTML(id, val) {
            const el = document.getElementById(id);
            if(el) el.innerHTML = val;
        }

        function fmt(num) {
            return num.toLocaleString(undefined, { maximumFractionDigits: 1, minimumFractionDigits: 0 });
        }

        function calculateCapacity(hc, tat, hours, lines = null) {
            if (tat <= 0) return 0;
            let effectiveResource = hc;
            if (lines !== null) {
                effectiveResource = Math.min(hc, lines);
            }
            return (effectiveResource * hours) / tat;
        }

        function populateYearSelector() {
            const selector = document.getElementById('yearSelector');
            const currentYear = new Date().getFullYear();
            const years = Object.keys(KR_WORKING_DAYS).sort((a, b) => b - a); 

            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                selector.appendChild(option);
            });

            const defaultYear = years.includes(currentYear.toString()) ? currentYear.toString() : '2025';
            selector.value = defaultYear;
        }

        function calculateAll() {
            const hours = getVal('globalWorkTime');
            
            // Get Annual Working Days
            const selectedYear = document.getElementById('yearSelector').value;
            const annualDays = KR_WORKING_DAYS[selectedYear] || 245; 
            document.getElementById('annualWorkingDaysDisplay').innerText = annualDays;
            
            // ==========================================
            // 1. RF Generator Logic (Integrated)
            // ==========================================
            const rfgTotalAssy = getVal('rfg_total_assy_worker');
            const rfgTotalTest = getVal('rfg_total_test_worker');
            const rfgTotalLines = getVal('rfg_total_lines');

            const rfgMaxUsable = rfgTotalTest; 
            const rfgMaxElem = document.getElementById('rfg_max_usable_lines');
            if (rfgMaxElem) {
                if (rfgTotalLines > rfgMaxUsable) {
                    rfgMaxElem.innerHTML = `${rfgMaxUsable} <span class="text-red-500 text-[9px] font-normal">(HC Limited)</span>`;
                    rfgMaxElem.className = "font-bold text-red-500";
                } else {
                    rfgMaxElem.innerHTML = rfgMaxUsable;
                    rfgMaxElem.className = "font-bold text-apple-blue";
                }
            }

            const alloc1kPct = getVal('rfg_1k_alloc_pct');
            const alloc2kPct = 100 - alloc1kPct;
            setHTML('rfg_2k_alloc_disp', alloc2kPct.toFixed(0));

            const ratio1kAssy = getVal('rfg_1k_assy_ratio') / 100;
            const ratio1kTest = getVal('rfg_1k_test_ratio') / 100;

            const tatAssy2k = getVal('rfg_2k_base_assy_tat');
            const tatTest2k = getVal('rfg_2k_base_test_tat');
            const tatAssy1k = tatAssy2k * ratio1kAssy;
            const tatTest1k = tatTest2k * ratio1kTest;

            const assyW2k = rfgTotalAssy * (alloc2kPct / 100);
            const assyW1k = rfgTotalAssy * (alloc1kPct / 100);
            const testW2k = rfgTotalTest * (alloc2kPct / 100);
            const testW1k = rfgTotalTest * (alloc1kPct / 100);
            const lines2k = rfgTotalLines * (alloc2kPct / 100);
            const lines1k = rfgTotalLines * (alloc1kPct / 100);

            const capaAssy2k = calculateCapacity(assyW2k, tatAssy2k, hours);
            const capaTest2k = calculateCapacity(testW2k, tatTest2k, hours, lines2k);
            const finalCapa2k = Math.min(capaAssy2k, capaTest2k);

            const capaAssy1k = calculateCapacity(assyW1k, tatAssy1k, hours);
            const capaTest1k = calculateCapacity(testW1k, tatTest1k, hours, lines1k);
            const finalCapa1k = Math.min(capaAssy1k, capaTest1k);

            const totalRfgCapaDaily = finalCapa2k + finalCapa1k;
            const totalRfgCapaYearly = totalRfgCapaDaily * annualDays;
            const totalRfgCapaMonthly = totalRfgCapaYearly / 12;

            setHTML('rfg_total_capa_d', fmt(totalRfgCapaDaily));
            setHTML('rfg_total_capa_m', fmt(totalRfgCapaMonthly));
            setHTML('rfg_total_capa_y', fmt(totalRfgCapaYearly));

            let bnMsgRfg = "";
            if (capaAssy2k < capaTest2k) bnMsgRfg += "2K: Assy limited. ";
            else if (capaTest2k < capaAssy2k) bnMsgRfg += "2K: Test limited. ";
            if (capaAssy1k < capaTest1k) bnMsgRfg += "1K: Assy limited.";
            else if (capaTest1k < capaAssy1k) bnMsgRfg += "1K: Test limited.";
            if(bnMsgRfg === "") bnMsgRfg = "Process Balanced";
            setHTML('rfg_bottleneck', bnMsgRfg);

            // ==========================================
            // 2. RF Matcher Logic (Integrated)
            // ==========================================
            const rfmTotalAssy = getVal('rfm_total_assy_worker');
            const rfmTotalTest = getVal('rfm_total_test_worker');
            const rfmTotalLines = getVal('rfm_total_lines');

            const rfmMaxUsable = rfmTotalTest;
            const rfmMaxElem = document.getElementById('rfm_max_usable_lines');
            if (rfmMaxElem) {
                 if (rfmTotalLines > rfmMaxUsable) {
                    rfmMaxElem.innerHTML = `${rfmMaxUsable} <span class="text-red-500 text-[9px] font-normal">(HC Limited)</span>`;
                    rfmMaxElem.className = "font-bold text-red-500";
                } else {
                    rfmMaxElem.innerHTML = rfmMaxUsable;
                    rfmMaxElem.className = "font-bold text-apple-blue";
                }
            }

            const allocSrfmPct = getVal('rfm_srfm_alloc_pct');
            const allocDrfmPct = 100 - allocSrfmPct;
            setHTML('rfm_drfm_alloc_disp', allocDrfmPct.toFixed(0));

            const ratioSrfmAssy = getVal('rfm_srfm_assy_ratio') / 100;
            const ratioSrfmTest = getVal('rfm_srfm_test_ratio') / 100;

            const tatAssyDrfm = getVal('rfm_drfm_base_assy_tat');
            const tatTestDrfm = getVal('rfm_drfm_base_test_tat');
            const tatAssySrfm = tatAssyDrfm * ratioSrfmAssy;
            const tatTestSrfm = tatTestDrfm * ratioSrfmTest;

            const assyWDrfm = rfmTotalAssy * (allocDrfmPct / 100);
            const assyWSrfm = rfmTotalAssy * (allocSrfmPct / 100);
            const testWDrfm = rfmTotalTest * (allocDrfmPct / 100);
            const testWSrfm = rfmTotalTest * (allocSrfmPct / 100);
            const linesDrfm = rfmTotalLines * (allocDrfmPct / 100);
            const linesSrfm = rfmTotalLines * (allocSrfmPct / 100);

            const capaAssyDrfm = calculateCapacity(assyWDrfm, tatAssyDrfm, hours);
            const capaTestDrfm = calculateCapacity(testWDrfm, tatTestDrfm, hours, linesDrfm);
            const finalCapaDrfm = Math.min(capaAssyDrfm, capaTestDrfm);

            const capaAssySrfm = calculateCapacity(assyWSrfm, tatAssySrfm, hours);
            const capaTestSrfm = calculateCapacity(testWSrfm, tatTestSrfm, hours, linesSrfm);
            const finalCapaSrfm = Math.min(capaAssySrfm, capaTestSrfm);

            const totalRfmCapaDaily = finalCapaDrfm + finalCapaSrfm;
            const totalRfmCapaYearly = totalRfmCapaDaily * annualDays;
            const totalRfmCapaMonthly = totalRfmCapaYearly / 12;

            setHTML('rfm_total_capa_d', fmt(totalRfmCapaDaily));
            setHTML('rfm_total_capa_m', fmt(totalRfmCapaMonthly));
            setHTML('rfm_total_capa_y', fmt(totalRfmCapaYearly));

            let bnMsgRfm = "";
            if (capaAssyDrfm < capaTestDrfm) bnMsgRfm += "DRFM: Assy limited. ";
            else if (capaTestDrfm < capaAssyDrfm) bnMsgRfm += "DRFM: Test limited. ";
            if (capaAssySrfm < capaTestSrfm) bnMsgRfm += "SRFM: Assy limited.";
            else if (capaTestSrfm < capaAssySrfm) bnMsgRfm += "SRFM: Test limited.";
            if(bnMsgRfm === "") bnMsgRfm = "Process Balanced";
            setHTML('rfm_bottleneck', bnMsgRfm);


            // ==========================================
            // 3. EVC Logic (Combined) - NEW
            // ==========================================
            const evcTotalAssy = getVal('evc_com_total_assy_worker');
            const evcTotalTest = getVal('evc_com_total_test_worker');
            const evcTotalLines = getVal('evc_com_total_lines');

            // Max Usable Lines (EVC)
            const evcMaxUsable = evcTotalTest;
            const evcMaxElem = document.getElementById('evc_com_max_usable_lines');
            if (evcMaxElem) {
                 if (evcTotalLines > evcMaxUsable) {
                    evcMaxElem.innerHTML = `${evcMaxUsable} <span class="text-red-500 text-[9px] font-normal">(HC Limited)</span>`;
                    evcMaxElem.className = "font-bold text-red-500";
                } else {
                    evcMaxElem.innerHTML = evcMaxUsable;
                    evcMaxElem.className = "font-bold text-apple-blue";
                }
            }

            // Allocation: User inputs Tykon %, Quantum is calculated
            const allocTykonPct = getVal('evc_tykon_alloc_pct');
            const allocQuantPct = 100 - allocTykonPct;
            setHTML('evc_quantum_alloc_disp', allocQuantPct.toFixed(0));

            // Ratios (Tykon vs Quantum)
            const ratioTykonAssy = getVal('evc_tykon_assy_ratio') / 100;
            const ratioTykonTest = getVal('evc_tykon_test_ratio') / 100;

            // Baseline TAT (Quantum)
            const tatAssyQuant = getVal('evc_q_base_assy_tat');
            const tatTestQuant = getVal('evc_q_base_test_tat');
            
            // Calculated TAT (Tykon)
            const tatAssyTykon = tatAssyQuant * ratioTykonAssy;
            const tatTestTykon = tatTestQuant * ratioTykonTest;

            // Resource Distribution
            const assyWQuant = evcTotalAssy * (allocQuantPct / 100);
            const assyWTykon = evcTotalAssy * (allocTykonPct / 100);
            const testWQuant = evcTotalTest * (allocQuantPct / 100);
            const testWTykon = evcTotalTest * (allocTykonPct / 100);
            const linesQuant = evcTotalLines * (allocQuantPct / 100);
            const linesTykon = evcTotalLines * (allocTykonPct / 100);

            // Capacity Calculation
            const capaAssyQuant = calculateCapacity(assyWQuant, tatAssyQuant, hours);
            const capaTestQuant = calculateCapacity(testWQuant, tatTestQuant, hours, linesQuant);
            const finalCapaQuant = Math.min(capaAssyQuant, capaTestQuant);

            const capaAssyTykon = calculateCapacity(assyWTykon, tatAssyTykon, hours);
            const capaTestTykon = calculateCapacity(testWTykon, tatTestTykon, hours, linesTykon);
            const finalCapaTykon = Math.min(capaAssyTykon, capaTestTykon);

            // Totals
            const totalEvcCapaDaily = finalCapaQuant + finalCapaTykon;
            const totalEvcCapaYearly = totalEvcCapaDaily * annualDays;
            const totalEvcCapaMonthly = totalEvcCapaYearly / 12;

            setHTML('evc_com_total_capa_d', fmt(totalEvcCapaDaily));
            setHTML('evc_com_total_capa_m', fmt(totalEvcCapaMonthly));
            setHTML('evc_com_total_capa_y', fmt(totalEvcCapaYearly));

            // Bottleneck
            let bnMsgEvc = "";
            if (capaAssyQuant < capaTestQuant) bnMsgEvc += "Quantum: Assy limited. ";
            else if (capaTestQuant < capaAssyQuant) bnMsgEvc += "Quantum: Test limited. ";
            if (capaAssyTykon < capaTestTykon) bnMsgEvc += "Tykon: Assy limited.";
            else if (capaTestTykon < capaAssyTykon) bnMsgEvc += "Tykon: Test limited.";
            if(bnMsgEvc === "") bnMsgEvc = "Process Balanced";
            setHTML('evc_com_bottleneck', bnMsgEvc);


            // ==========================================
            // 4. EVC (Individual)
            // ==========================================
            products.forEach(p => {
                const assyCapa = calculateCapacity(getVal(p.id + '_assy_worker'), getVal(p.id + '_assy_tat'), hours);
                const testCapa = calculateCapacity(getVal(p.id + '_test_worker'), getVal(p.id + '_test_tat'), hours, getVal(p.id + '_line'));
                
                const dailyCapa = Math.min(assyCapa, testCapa);
                const yearlyCapa = dailyCapa * annualDays;
                const monthlyCapa = yearlyCapa / 12;

                setHTML(p.id + '_capa_d', fmt(dailyCapa));
                setHTML(p.id + '_capa_m', fmt(monthlyCapa));
                setHTML(p.id + '_capa_y', fmt(yearlyCapa));

                // Bottleneck
                const bottleneckMsg = document.getElementById(p.id + '_bottleneck');
                if (assyCapa < testCapa) bottleneckMsg.innerHTML = "Bottleneck: ASSY";
                else if (testCapa < assyCapa) bottleneckMsg.innerHTML = "Bottleneck: TEST";
                else bottleneckMsg.innerHTML = "BALANCED";
            });
        }

        // Initialize 
        populateYearSelector();
        calculateAll();
    </script>
</body>
</html>